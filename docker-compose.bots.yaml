version: "3.9"
services:

  bot:
    image: ghcr.io/delvtech/elf-simulations/elf-sims:{ELFPY_TAG}
    profiles:
      - "bots"
    working_dir: /app/
    command: |
      /bin/sh -c "
        echo 'Starting bot...' &&
        python -c 'from elfpy.bots import BotConfig; config = BotConfig(); config.artifacts_url = \"http://artifacts:80\"; config.rpc_url = \"http://ethereum:8545\"; config.log_filename=\"docker-bot\"; config.log_file_and_stdout=True; config.save_as_json(\"docker-config.json\")' &&
        cat docker-config.json &&
        curl --verbose --include -H \"Content-Type: application/json\" -d @docker-config.json http://botserver:5000/run_script
      "
    volumes:
      - artifacts:/app/artifacts
    depends_on:
      - botserver
      - artifacts

volumes:
  artifacts:
