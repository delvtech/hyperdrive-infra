version: "3.9"
services:

  ethereum:
    image: ghcr.io/foundry-rs/foundry
    # without --block-time we're in "automine" mode and blocks are mined
    # as soon as transactions are received, or with manual commands.
    # this is "hecking fast" mode.
    command: |
      'anvil --host 0.0.0.0'
    # Open ports here are for devel
    ports:
      - 8545:8545

  # migrations:
  #   # 2022-04-10 after 4216273fa644194ab350d9446225b2118c52b98b
  #   # image: ghcr.io/delvtech/hyperdrive/migrations:nightly-f17bc5c65937626a49f3606666f3d4864532c934
  #   # 2022-05-31
  #   # image: ghcr.io/delvtech/hyperdrive/migrations:nightly-3188e7df62a07a77c61c467ab640aeec836c79fe # v0.02
  #   image: ghcr.io/delvtech/hyperdrive/migrations:nightly-62696e9a371da64aa0facf5865f580747a067d36 # v0.0.2 w/ prints
  #   environment:
  #     - ETH_FROM=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
  #     - PRIVATE_KEY=ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
  #     - RPC_URL=http://ethereum:8545
  #   volumes:
  #     - artifacts:/src/artifacts/
  #   # TODO: This is a band-aid solution for the memory leaks experienced on
  #   # Apple Silicon. Remove the restart policy when this reliably starts.
  #   restart: on-failure:5

  artifacts:
    image: ghcr.io/delvtech/infra/artifacts:0.0.1
    volumes:
      - artifacts:/var/www/artifacts/
    # Open ports here are for devel
    ports:
      - 80:80

    #bot:
    #  # 2022-05-31 afer "generalized bot settings working with FixedPoint" (#484)
    #  # image: ghcr.io/delvtech/elf-simulations/elf-sims:nightly-2ef72dd9879511d639695b83b35fb2463b6b2ca6
    #  # local elf-sims pointing to IHyperdrive
    #  # image: ghcr.io/delvtech/elf-simulations/elf-sims:nightly-2eebd2991ceaab5db0b3f2703fcb667412508c25
    #  image: elf-sims:latest
    #  working_dir: /app/
    #  environment:
    #    - BOT_DEVNET=true
    #    - BOT_RPC_URL=http://ethereum:8545
    #    - BOT_LOG_FILENAME=testnet_bots
    #    - BOT_LOG_LEVEL=INFO
    #    # TODO get default value for this
    #    - BOT_MAX_BYTES=100
    #    - BOT_NUM_LOUIE=0
    #    - BOT_NUM_FRIDA=0
    #    - BOT_NUM_RANDOM=4
    #    - BOT_TRADE_CHANCE=0.1
    #    - BOT_ALCHEMY=false
    #    - BOT_ARTIFACTS_URL=http://artifacts:80
    #
    #  volumes:
    #    - ../elf-simulations-upstream/:/app/
    #
    #  command: "/bin/sh -c 'python examples/evm_bots.py'"
volumes:
  artifacts:
