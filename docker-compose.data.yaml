version: "3.9"
services:

  data:
    image: ${ELFPY_IMAGE}
    profiles:
      - "data"
    working_dir: /app/
    command: /bin/sh -c "python lib/chainsync/bin/acquire_data.py"
    # This file sets postgres information
    env_file:
      - .env
    # These environment variables are connecting to other necessary containers
    environment:
      - CONTRACTS_URL=${ARTIFACTS_URL}/addresses.json
      - ETHEREUM_NODE=${RPC_URL}

  username-reg:
    image: ${ELFPY_IMAGE}
    profiles:
      - "data"
    working_dir: /app/
    command: /bin/sh -c "python lib/chainsync/bin/register_username_server.py"
    # This file sets postgres information
    env_file:
      - .env

  dashboard:
    image: ${ELFPY_IMAGE}
    profiles:
      - "data"
    working_dir: /app/
    command: /bin/sh -c "streamlit run lib/chainsync/bin/run_hyperdrive_dashboard.py \
               --server.port=8501 --server.headless true\
               --server.fileWatcherType=none --browser.gatherUsageStats=false"
    # This file sets postgres information
    env_file:
      - .env
    environment:
      # TODO these should eventually be removed in favor of seperate process writing
      # pnl to database
      - ARTIFACTS_URL=${ARTIFACTS_URL}
      - RPC_URL=${RPC_URL}


volumes:
  artifacts:
